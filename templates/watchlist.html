{% extends "layout.html" %}

{% block content %}

<script>
    $(document).ready(function() {
        $("#addStockOpenModal").click(function() {
            $('.ui.basic.modal').modal('show');
        });

        $("#addStockConfirm").click(function() {
            var ticker = $("#addStockTicker").val();
            console.log(ticker);

            $.ajax({
                url: '/finances/stocks/watchlist/add-stock',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({"ticker": ticker}),
                dataType: 'json'
            });

            $('.ui.basic.modal').modal('hide');
            window.location.reload();
        });

        let n = $("#stockTable >tbody >tr").length;
        let v1;
        for(let i = 1; i <= n; i++) {
            //color value change fields
            v1 =$("#valueChange" + [i]).text();
            v1 = parseFloat(v1.substring(0, v1.length - 2));
            if(v1 < 0) $("#valueChange" + [i]).addClass("negative");
            else if (v1 > 0) $("#valueChange" + [i]).addClass("positive");
        }      
    });
</script>

<div style="padding: 2ex;">

    <!-- Modal to add a stock to the watchlist -->
    <div class="ui basic modal">
        <!-- hader -->
        <div class="ui icon header">
            <i class="chart area icon"></i>
            Add Stock to Watchlist
        </div>

        <!-- ticker input textbox -->
        <div class="ui input">
            <input type="text" id="addStockTicker" placeholder="Stock Ticker ...">
        </div><br>

        <div class="actions">

            <!-- cancel button -->
            <div id="addStockCancel" class="ui red basic cancel inverted button">
                <i class="remove icon"></i>
                Cancel
            </div>

            <!-- confirm button -->
            <div id="addStockConfirm" class="ui green ok inverted button">
                <i class="checkmark icon"></i>
                Confirm
            </div>
        </div>
    </div>
    
    <!-- Button to open the add stock modal -->
    <div class="ui animated button" tabindex="0" id="addStockOpenModal">
        <div class="hidden content">Add</div>
        <div class="visible content">
            <i class="plus icon"></i>
        </div>
    </div>

    <!-- Stock table -->
    <table id="stockTable" class="ui sortable celled table">
        <thead>
            <tr>
                <th>Ticker</th>
                <th>Value</th>
                <th>Stock Value Change</th>
                <th>Relative Stock Value Change</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            {% if stocks is not none %}
                {% for stock in stocks %}
                <tr>
                    <td>{{ stock[0] }}</td>
                    <td>{{ stock[1] }}</td>
                    <td>{{ stock[2] }}</td>
                    <td id="valueChange{{loop.index}}">{{ stock[3] }}</td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>

{% endblock %}